<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Customize Malaysia Trip - Tripwise</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <link rel="stylesheet" href="tripwise-auth-final.css">
    <style>
        /* ===== Collapsible Activity Card Styles ===== */

/* Activity Item - Collapsible */
.collapsible-activity {
    border-radius: 12px;
    border: 1px solid #e5e7eb;
    background: #ffffff;
    box-shadow: 0 2px 12px rgba(15, 23, 42, 0.08);
    margin-bottom: 0.75rem;
    overflow: hidden;
    transition: all 0.2s ease;
}

.collapsible-activity:hover {
    transform: translateY(-1px);
    box-shadow: 0 8px 24px rgba(15, 23, 42, 0.12);
}

.collapsible-activity-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0.9rem 1rem;
    cursor: pointer;
    background: #f9fafb;
}

.activity-collapsed-left {
    display: flex;
    align-items: center;
    gap: 0.8rem;
    flex: 1;
}

.activity-icon-small {
    width: 36px;
    height: 36px;
    background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
    color: var(--white);
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
}

.activity-main-info {
    display: flex;
    flex-direction: column;
    gap: 0.1rem;
}

.activity-type-chip {
    font-size: 0.75rem;
    color: #64748b;
    margin-bottom: 0.25rem;
    display: flex;
    align-items: center;
    gap: 0.3rem;
}

.activity-name-large {
    font-weight: 600;
    font-size: 0.95rem;
    color: var(--dark-gray);
}

.activity-time-summary {
    font-size: 0.8rem;
    color: #6b7280;
}

.activity-price-chip {
    padding: 0.25rem 0.5rem;
    border-radius: 999px;
    background: #ecfdf5;
    color: #065f46;
    font-size: 0.78rem;
    font-weight: 600;
    display: inline-flex;
    align-items: center;
    gap: 0.25rem;
}

.activity-price-chip.free {
    background: #eff6ff;
    color: #1d4ed8;
}

.activity-price-chip i {
    font-size: 0.9rem;
}

.activity-toggle-icon {
    margin-left: 1rem;
    font-size: 1.1rem;
    color: #9ca3af;
    transition: transform 0.2s ease;
}

.collapsible-activity.open .activity-toggle-icon {
    transform: rotate(180deg);
}

.collapsible-activity-body {
    padding: 0.75rem 1rem 0.9rem;
    border-top: 1px solid #e5e7eb;
    background: #ffffff;
    display: none;
}

.collapsible-activity.open .collapsible-activity-body {
    display: block;
}

/* Expanded Content Layout */
.activity-details-expanded {
    display: grid;
    grid-template-columns: minmax(0, 1.7fr) minmax(0, 1.1fr);
    gap: 1.25rem;
    align-items: flex-start;
}

.activity-description-expanded {
    font-size: 0.85rem;
    color: #4b5563;
    line-height: 1.6;
    margin-bottom: 0.75rem;
}

.activity-meta-expanded {
    display: grid;
    gap: 0.45rem;
    font-size: 0.8rem;
    color: #4b5563;
}

.meta-row {
    display: flex;
    align-items: center;
    gap: 0.35rem;
}

.meta-row i {
    width: 16px;
    text-align: center;
    color: #6b7280;
}

/* Activity Map Link in Expanded View */
.activity-map-link {
    margin-top: 0.5rem;
    margin-bottom: 0.8rem;
}

.map-link {
    color: var(--secondary-blue);
    text-decoration: none;
    font-size: 0.85rem;
    font-weight: 500;
    display: inline-flex;
    align-items: center;
    gap: 0.3rem;
    transition: color 0.2s ease;
}

.map-link i {
    font-size: 0.85rem;
}

.map-link:hover {
    color: var(--primary-blue);
}

/* Expanded Action Buttons */
.activity-expanded-actions {
    display: flex;
    justify-content: flex-end;
    gap: 0.4rem;
    margin-top: 0.75rem;
}

.activity-expanded-actions .btn-small {
    font-size: 0.78rem;
    padding: 0.35rem 0.7rem;
}

/* Responsive */
@media (max-width: 768px) {
    .activity-details-expanded {
        grid-template-columns: 1fr;
    }

    .collapsible-activity-header {
        align-items: flex-start;
        gap: 0.5rem;
    }

    .activity-collapsed-left {
        align-items: flex-start;
    }
}

/* ===== End Collapsible Card Styles ===== */


/* ===== Toast Styles (if not present in your CSS) ===== */
.toast {
    position: fixed;
    bottom: 24px;
    left: 50%;
    transform: translateX(-50%) translateY(120%);
    background: #111827;
    color: #f9fafb;
    padding: 0.85rem 1.2rem;
    border-radius: 999px;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    box-shadow: 0 10px 30px rgba(15, 23, 42, 0.35);
    font-size: 0.85rem;
    opacity: 0;
    pointer-events: none;
    transition: transform 0.25s ease, opacity 0.25s ease;
    z-index: 9999;
}

.toast.show {
    transform: translateX(-50%) translateY(0%);
    opacity: 1;
    pointer-events: auto;
}

.toast i {
    color: #22c55e;
}

/* ===== Modal Styles ===== */

.modal-backdrop {
    position: fixed;
    inset: 0;
    background: rgba(15, 23, 42, 0.55);
    backdrop-filter: blur(3px);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 50;
}

.modal {
    background: #0f172a;
    border-radius: 16px;
    padding: 1.5rem;
    max-width: 420px;
    width: 100%;
    border: 1px solid rgba(148, 163, 184, 0.35);
    box-shadow: 0 25px 80px rgba(15, 23, 42, 0.75);
}

.modal-header {
    display: flex;
    gap: 0.75rem;
    margin-bottom: 0.75rem;
    align-items: flex-start;
}

.modal-header-icon {
    width: 32px;
    height: 32px;
    border-radius: 999px;
    background: rgba(96, 165, 250, 0.15);
    display: flex;
    align-items: center;
    justify-content: center;
    color: #60a5fa;
}

.modal-title {
    font-size: 1.05rem;
    font-weight: 600;
    color: #e5e7eb;
}

.modal-subtitle {
    font-size: 0.86rem;
    color: #9ca3af;
    margin-top: 0.15rem;
}

.modal-body {
    margin-top: 0.5rem;
    margin-bottom: 1rem;
}

.modal-input-group {
    display: flex;
    flex-direction: column;
    gap: 0.35rem;
}

.modal-label {
    font-size: 0.8rem;
    color: #9ca3af;
}

.modal-input {
    width: 100%;
    padding: 0.6rem 0.75rem;
    background: #020617;
    border-radius: 10px;
    border: 1px solid #1f2937;
    color: #e5e7eb;
    font-size: 0.88rem;
    outline: none;
    transition: border-color 0.18s ease, box-shadow 0.18s ease;
}

.modal-input:focus {
    border-color: #3b82f6;
    box-shadow: 0 0 0 1px rgba(59,130,246,0.5);
}

.modal-footer {
    display: flex;
    justify-content: flex-end;
    gap: 0.5rem;
}

.btn-secondary,
.btn-primary {
    border-radius: 999px;
    padding: 0.45rem 0.95rem;
    font-size: 0.85rem;
    font-weight: 500;
    border: 1px solid transparent;
    cursor: pointer;
    display: inline-flex;
    align-items: center;
    gap: 0.3rem;
}

.btn-secondary {
    background: transparent;
    color: #e5e7eb;
    border-color: #4b5563;
}

.btn-secondary:hover {
    border-color: #9ca3af;
    background: rgba(31,41,55,0.7);
}

.btn-primary {
    background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
    color: #eff6ff;
    border: none;
    box-shadow: 0 8px 25px rgba(37,99,235,0.5);
}

.btn-primary:hover {
    filter: brightness(1.05);
}

.modal-error {
    font-size: 0.78rem;
    color: #f97373;
    margin-top: 0.25rem;
}

/* Utility */
.hidden {
    display: none !important;
}


/* ===== Modal Trigger Button (Optional) ===== */
.btn-save-trigger {
    display: inline-flex;
    align-items: center;
    gap: 0.35rem;
    padding: 0.6rem 1rem;
    border-radius: 999px;
    background: #111827;
    color: #e5e7eb;
    border: 1px solid #4b5563;
    font-size: 0.85rem;
    cursor: pointer;
    transition: all 0.2s ease;
}

.btn-save-trigger:hover {
    background: #020617;
    border-color: #9ca3af;
}

/* ===== Trip Save Modal (New Design) ===== */
.tw-modal-overlay {
  position: fixed;
  inset: 0;
  background: rgba(15, 23, 42, 0.55);
  backdrop-filter: blur(3px);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 90;
}

.tw-modal {
  background: radial-gradient(circle at top left, #1d4ed8 0, #020617 40%);
  border-radius: 18px;
  padding: 1.6rem 1.5rem 1.4rem;
  max-width: 420px;
  width: 100%;
  border: 1px solid rgba(148, 163, 184, 0.65);
  box-shadow: 0 26px 70px rgba(15, 23, 42, 0.92);
}

.tw-modal-title {
  font-size: 1.05rem;
  font-weight: 600;
  color: #e5e7eb;
  margin-bottom: 0.35rem;
}

.tw-modal-text {
  font-size: 0.86rem;
  color: #9ca3af;
  margin-bottom: 0.9rem;
}

.tw-input {
  width: 100%;
  padding: 0.6rem 0.75rem;
  background: #020617;
  border-radius: 10px;
  border: 1px solid #1f2937;
  color: #e5e7eb;
  font-size: 0.88rem;
  outline: none;
  transition: border-color 0.18s ease, box-shadow 0.18s ease;
  margin-bottom: 0.9rem;
}

.tw-input:focus {
  border-color: #3b82f6;
  box-shadow: 0 0 0 1px rgba(59,130,246,0.45);
}

.tw-modal-actions {
  display: flex;
  justify-content: flex-end;
  gap: 0.55rem;
}

    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <nav class="navbar">
            <div class="nav-container">
                <div class="logo">
                    <div class="logo-placeholder">
                        <i class="fas fa-plane-departure"></i>
                        <span>Tripwise</span>
                    </div>
                </div>
                
                <ul class="nav-menu">
                    <li class="nav-item">
                        <a href="index.html" class="nav-link">
                            <i class="fas fa-home"></i>
                            Home
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="malaysia-custom-plan.html" class="nav-link active">
                            <i class="fas fa-route"></i>
                            Malaysia Planner
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="profile.html" class="nav-link">
                            <i class="fas fa-user-circle"></i>
                            Profile
                        </a>
                    </li>
                </ul>

                <div class="auth-section">
                    <button class="btn btn-secondary" id="loginBtn">
                        <i class="fas fa-sign-in-alt"></i>
                        Login
                    </button>
                    <button class="btn btn-secondary" id="profileBtn" style="display: none;">
                        <i class="fas fa-user-circle"></i>
                        My Profile
                    </button>
                    <button class="btn btn-outline" id="logoutBtn" style="display: none;">
                        <i class="fas fa-sign-out-alt"></i>
                        Logout
                    </button>
                </div>

                <button class="btn-icon" id="btnMobileMenu">
                    <i class="fas fa-bars"></i>
                </button>
            </div>
        </nav>
    </header>

    <!-- Main Layout -->
    <main class="planner-layout">
        <!-- Sidebar: Days List -->
        <aside class="planner-sidebar" id="plannerSidebar">
            <div class="sidebar-header">
                <h1>
                    <i class="fas fa-mountain"></i>
                    <span>Malaysia Adventure</span>
                </h1>
                <div class="trip-meta">
                    <span id="tripDateRange">
                        <i class="fas fa-calendar"></i>
                        7-Day Malaysian Journey
                    </span>
                    <span>
                        <i class="fas fa-map-marked-alt"></i>
                        Kuala Lumpur → Cameron Highlands → Langkawi
                    </span>
                </div>
            </div>

            <div class="sidebar-controls">
                <button class="btn-control btn-add-day" id="btnAddDay">
                    <i class="fas fa-plus"></i>
                    Add Day
                </button>
                <button class="btn-control btn-save" id="btnSavePlan">
                    <i class="fas fa-save"></i>
                    Save Plan
                </button>
            </div>

            <div class="day-list" id="dayListContainer">
                <!-- Days will be injected here -->
            </div>

            <div class="sidebar-footer">
                <p class="sidebar-tip">
                    <i class="fas fa-lightbulb"></i>
                    Tip: Start by editing Day 1 and work your way through the week.
                </p>
            </div>
        </aside>

        <!-- Main Content Area -->
        <section class="planner-main">
            <!-- Map + Tabs -->
            <div class="planner-top">
                <div class="planner-tabs">
                    <button class="tab-button active" id="tabRouteMap">Route Map</button>
                    <button class="tab-button" id="tabBalance">Daily Summary</button>
                </div>

                <div class="planner-tab-contents">
                    <div class="tab-content active" id="mapView">
                        <div class="map-container">
                            <div id="map"></div>
                        </div>
                    </div>

                    <div class="tab-content" id="balanceView">
                        <div class="balance-card" id="balanceContent">
                            <!-- Daily summary injected here -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Activities Section -->
            <div class="planner-bottom">
                <div class="day-header">
                    <div class="day-info">
                        <h2 id="selectedDayTitle">Select a day to edit</h2>
                        <p id="selectedDaySubtitle">Choose a day from the left panel to start customizing your Malaysia trip.</p>
                    </div>
                    <button class="btn btn-primary" id="btnAddActivity">
                        <i class="fas fa-plus-circle"></i>
                        Add Activity
                    </button>
                </div>

                <div class="activities-list" id="activitiesList">
                    <!-- Activities for selected day injected here -->
                </div>
            </div>
        </section>
    </main>

    <!-- Day Modal -->
    <div class="modal-backdrop hidden" id="modalDay">
        <div class="modal">
            <div class="modal-header">
                <div class="modal-header-icon">
                    <i class="fas fa-sun"></i>
                </div>
                <div>
                    <div class="modal-title" id="modalDayTitle">Add Day</div>
                    <div class="modal-subtitle">Set the title and date for this day in your itinerary.</div>
                </div>
            </div>
            <form id="formDay">
                <div class="modal-body">
                    <div class="modal-input-group">
                        <label for="dayTitle" class="modal-label">Day Title</label>
                        <input type="text" id="dayTitle" class="modal-input" placeholder="e.g. Kuala Lumpur City Highlights" required />
                    </div>
                    <div class="modal-input-group" style="margin-top: 0.6rem;">
                        <label for="dayDate" class="modal-label">Date (optional)</label>
                        <input type="date" id="dayDate" class="modal-input" />
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn-secondary" id="btnCancelDay">Cancel</button>
                    <button type="submit" class="btn-primary">Save Day</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Activity Modal -->
    <div class="modal-backdrop hidden" id="modalActivity">
        <div class="modal">
            <div class="modal-header">
                <div class="modal-header-icon">
                    <i class="fas fa-map-marker-alt"></i>
                </div>
                <div>
                    <div class="modal-title" id="modalActivityTitle">Add Activity</div>
                    <div class="modal-subtitle">Add attractions, food stops or experiences for this day.</div>
                </div>
            </div>
            <form id="formActivity">
                <div class="modal-body">
                    <div class="modal-input-group">
                        <label for="activityType" class="modal-label">Type</label>
                        <select id="activityType" class="modal-input" required>
                            <option value="Sightseeing">Sightseeing</option>
                            <option value="Food">Food</option>
                            <option value="Experience">Experience</option>
                            <option value="Shopping">Shopping</option>
                            <option value="Transfer">Transfer</option>
                        </select>
                    </div>

                    <div class="modal-input-group">
                        <label for="activityName" class="modal-label">Name</label>
                        <input type="text" id="activityName" class="modal-input" placeholder="e.g. Petronas Towers" required />
                    </div>

                    <div class="modal-input-group">
                        <label class="modal-label">Time</label>
                        <div style="display: flex; gap: 0.5rem;">
                            <input type="time" id="activityStartTime" class="modal-input" />
                            <input type="time" id="activityEndTime" class="modal-input" />
                        </div>
                    </div>

                    <div class="modal-input-group">
                        <label for="activityLocation" class="modal-label">Location</label>
                        <input type="text" id="activityLocation" class="modal-input" placeholder="e.g. Kuala Lumpur City Centre" />
                    </div>

                    <div class="modal-input-group">
                        <label for="activityLink" class="modal-label">Google Maps or Website Link</label>
                        <input type="url" id="activityLink" class="modal-input" placeholder="https://maps.google.com/..." />
                    </div>

                    <div class="modal-input-group">
                        <label for="activityDescription" class="modal-label">Description</label>
                        <textarea id="activityDescription" class="modal-input" rows="3" placeholder="Add notes or details about this stop."></textarea>
                    </div>

                    <div class="modal-input-group paid-fields">
                        <label for="activityPrice" class="modal-label">Estimated Cost</label>
                        <div style="display: flex; gap: 0.5rem;">
                            <input type="number" id="activityPrice" class="modal-input" min="0" step="1" placeholder="0" />
                            <select id="activityCurrency" class="modal-input" style="max-width: 120px;">
                                <option value="MYR">MYR</option>
                                <option value="USD">USD</option>
                                <option value="JPY">JPY</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn-secondary" id="btnCancelActivity">Cancel</button>
                    <button type="submit" class="btn-primary">Save Activity</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Trip Save Modal (new design) -->
    <div id="saveTripModal" class="tw-modal-overlay hidden">
      <div class="tw-modal">
        <h3 class="tw-modal-title">Save your trip</h3>
        <p class="tw-modal-text">
          Choose a name for this trip. You’ll see this name in your profile.
        </p>

        <input
          id="saveTripNameInput"
          type="text"
          class="tw-input"
          placeholder="e.g. Malaysia Autumn Trip"
        />

        <div class="tw-modal-actions">
          <button id="saveTripCancelBtn" class="btn-secondary">Cancel</button>
          <button id="saveTripConfirmBtn" class="btn-primary">Save trip</button>
        </div>
      </div>
    </div>

    <!-- Toast Notification -->
    <div class="toast" id="toast">
        <i class="fas fa-check-circle"></i>
        <span id="toastMessage"></span>
    </div>

    <!-- Scripts -->
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <script src="japan-custom-plan.js"></script>
</body>
</html>